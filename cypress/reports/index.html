publish-report:
  needs: test-firefox  # ou test-chrome
  runs-on: ubuntu-latest
  steps:
    - name: Checkout código
      uses: actions/checkout@v4

    - name: Download Regression Report
      uses: actions/download-artifact@v4
      with:
        name: mochawesome-report-regression-firefox
        path: ./public/regression

    - name: Download Smoke Report
      uses: actions/download-artifact@v4
      with:
        name: mochawesome-report-smoke-firefox
        path: ./public/smoke

    - name: Mover relatórios para raiz
      run: |
        mv ./public/regression/mochawesome.html ./public/mochawesome-regression.html
        mv ./public/smoke/mochawesome.html ./public/mochawesome-smoke.html
        rm -rf ./public/regression ./public/smoke

    - name: Criar index.html para GitHub Pages
      run: |
        cat << EOF > ./public/index.html
        <!DOCTYPE html>
        <html lang="pt-BR">
        <head>
          <meta charset="UTF-8" />
          <title>Relatórios de Testes</title>
          <style>
            body { font-family: sans-serif; padding: 2rem; background: #f9f9f9; }
            h1 { color: #333; }
            ul { list-style: none; padding-left: 0; }
            li { margin-bottom: 1rem; }
            a { text-decoration: none; color: #007acc; font-weight: bold; }
            a:hover { text-decoration: underline; }
          </style>
        </head>
        <body>
          <h1>Relatórios de Teste - Cypress + Mochawesome</h1>
          <ul>
            <li><a href="mochawesome-regression.html" target="_blank">🔍 Ver Relatório Regression</a></li>
            <li><a href="mochawesome-smoke.html" target="_blank">🚀 Ver Relatório Smoke</a></li>
          </ul>
        </body>
        </html>
        EOF

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v4
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
